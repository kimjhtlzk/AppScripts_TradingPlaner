# 📈 구글 스프레드시트 실시간 주식 트래커 v4.0 (최종)

구글 스프레드시트에서 NASDAQ, KOSPI, KOSDAQ 종목의 실시간 주가 정보를 자동으로 가져오는 심플한 시스템입니다.

## 🎯 v4.0 최종 버전 특징

- **자동 수식 적용**: 종목코드 입력시 자동으로 수식 생성 (Apps Script)
- **심플 구조**: 종목코드, 종목명, 현재가, 등락률만 표시
- **통합 수식**: 나스닥과 한국 주식 모두 지원
- **1분 자동 새로고침**: 실시간에 가까운 데이터 업데이트
- **초간단 사용법**: 종목코드와 시장구분만 입력하면 끝!

## 🚀 주요 기능

- **🤖 자동 수식 적용**: A열 종목코드 입력 → B, C, D열 자동 생성
- **실시간 주가 조회**: 종목코드 입력시 자동으로 현재가 표시
- **멀티 마켓 지원**: NASDAQ, KOSPI, KOSDAQ 통합 지원
- **자동 업데이트**: 1분마다 자동 새로고침
- **종목명 자동 표시**: 종목코드 입력시 종목명 자동 추출

## 📁 파일 구조

```
Trading/
├── README.md                                     # 이 파일 (전체 가이드)
├── auto_apply_formulas.gs                        # ⭐ 자동 수식 적용 + 새로고침 스크립트 (통합본)
├── complete_formula_with_error_handling_v2_fixed.txt # 수식 상세 설명
└── fixed_percentage_formula.txt                  # 등락률 수식 문제 해결 가이드
```

## 🛠️ 설치 방법 (v4.0 - 자동 수식 적용)

### 1단계: 구글 스프레드시트 생성
1. [구글 스프레드시트](https://sheets.google.com) 접속
2. 새 스프레드시트 생성

### 2단계: 헤더 설정 (A1~F1)
| A1 | B1 | C1 | D1 | E1 | F1 |
|---|---|---|---|---|---|
| 종목코드 | 종목명 | 현재가 | 등락률 | 시장구분 | (자동 새로고침 시간) |

*F1 셀은 자동 새로고침 시 마지막 업데이트 시간이 자동으로 표시됩니다.*

### 3단계: Apps Script 설치 (⭐ 중요)
1. **도구** → **스크립트 편집기**
2. 기존 코드 모두 삭제
3. `auto_apply_formulas.gs` 파일 내용 전체 복사
4. 붙여넣기 → **저장** (Ctrl+S 또는 Cmd+S)
5. 프로젝트 이름: "주식 트래커"

### 4단계: 권한 설정
1. 스크립트 편집기에서 **실행** 버튼 (▶) 클릭
2. 함수 선택: **onOpen**
3. **실행** 클릭
4. 권한 검토 화면 → **권한 검토**
5. 본인 계정 선택
6. **고급** → **"주식 트래커"(으)로 이동** 클릭
7. **허용** 클릭

### 5단계: 스프레드시트 새로고침
1. 스프레드시트 페이지로 돌아가기
2. **페이지 새로고침** (F5 또는 Cmd+R)
3. 상단 메뉴에 **"📈 주식 트래커"** 생성 확인

### 6단계: 서식 설정
1. **D열 선택** → **서식** → **숫자** → **백분율** → 소수점 2자리
2. **C열 통화 서식** (자동 적용):
   - 종목코드 입력시 자동으로 적용됨
   - 미국 주식: $195.42 (달러, 소수점 2자리)
   - 한국 주식: ₩71,300 (원화, 정수)
   - 또는 메뉴 → **💱 통화 서식 일괄 적용**

## 💡 사용 방법 (v4.0 - 자동 수식 적용)

### 방법 1: 자동 수식 적용 (권장)
1. **A열**에 종목코드 입력 (예: AAPL, 005930)
2. **E열**에 시장구분 입력 (NASDAQ, KOSPI, KOSDAQ)
3. **Enter** 키 → **자동으로 B, C, D열 수식 생성!**

예시:
```
A2에 "AAPL" 입력 → E2에 "NASDAQ" 입력 → Enter
→ B2, C2, D2 자동 생성!
```

### 방법 2: 기존 데이터 일괄 적용
이미 A열과 E열에 데이터를 입력한 경우:
1. 메뉴: **📈 주식 트래커** → **📝 모든 행에 수식 적용**
2. 모든 행에 자동으로 수식 적용

### 입력 예시:
| A열 | E열 |
|---|---|
| AAPL | NASDAQ |
| 005930 | KOSPI |
| TSLA | NASDAQ |
| 035720 | KOSDAQ |

### 자동 생성 결과:
| A열 | B열 | C열 | D열 | E열 | F열 |
|---|---|---|---|---|---|
| AAPL | Apple Inc. | **$195.42** | 1.23% | NASDAQ | 마지막 새로고침: 2025-10-17 14:32:15 |
| 005930 | 삼성전자 | **₩71,300** | -0.70% | KOSPI | |
| TSLA | Tesla, Inc. | **$242.84** | 1.47% | NASDAQ | |
| 035720 | 카카오 | **₩45,600** | 1.82% | KOSDAQ | |

*F1 셀에만 새로고침 시간이 표시됩니다.*
*C열은 시장구분(E열)에 따라 자동으로 달러($) 또는 원화(₩) 표시*

## 📊 지원 데이터

- **종목명**: 종목코드 입력시 자동 표시
- **현재가**: 실시간 주식 가격 (나스닥 최대 20분 지연)
- **등락률**: 전일 대비 변동률 (백분율 표시)

## 🔧 메뉴 기능 (📈 주식 트래커)

Apps Script 설치 후 상단에 "📈 주식 트래커" 메뉴가 생성됩니다:

### 메뉴 항목:
- **🔄 수동 새로고침**: 즉시 데이터 업데이트
- **⏰ 1분 자동 새로고침 시작**: 1분마다 자동 업데이트 (상태 표시 포함)
- **⏹ 자동 새로고침 중지**: 자동 업데이트 중지
- **🔧 오류 수정**: #NAME? 오류 수정
- **📝 모든 행에 수식 적용**: 기존 데이터에 수식 일괄 적용
- **💱 통화 서식 일괄 적용**: 모든 행에 통화 표시 서식 적용 ($ 또는 ₩)

### 사용 예시:
1. **자동 새로고침 시작**:
   - 메뉴 → **⏰ 1분 자동 새로고침 시작**
   - 1분마다 데이터 자동 업데이트
   - **F1 셀**에 "마지막 새로고침: 2025-10-17 14:32:15" 형식으로 표시
   - 오른쪽 하단에 "✅ 새로고침 완료" 토스트 표시

2. **수동 새로고침**:
   - 메뉴 → **🔄 수동 새로고침**
   - 즉시 모든 데이터 업데이트
   - **F1 셀**에 업데이트 시간 표시

## 🎨 조건부 서식 설정

### 등락률 색상 (D열)
1. **D열 선택**
2. **서식** → **조건부 서식**
3. 규칙 추가:
   - 상승: `=D2>0` → 빨간색
   - 하락: `=D2<0` → 파란색
   - 보합: `=D2=0` → 검은색

## 📊 데이터 업데이트 주기 및 지연 시간

### 데이터 소스별 실제 지연:
- **네이버 금융 (KOSPI/KOSDAQ)**: 실시간 데이터
- **Yahoo Finance (NASDAQ)**: 실시간 데이터
- **GOOGLEFINANCE**: 최대 20분 지연 가능

### 구글 스프레드시트 캐싱:
- **기본 IMPORTXML**: 15분마다 자동 새로고침
- **RANDBETWEEN 사용시**: 매번 새로운 데이터
- **Apps Script 사용시**: 1~5분마다 강제 새로고침

### 가격 차이 발생 이유:
1. 구글 스프레드시트의 15분 캐싱
2. IMPORTXML 함수 호출 제한 (50개/시트)
3. 네트워크 지연
4. 장 마감 후에는 종가 표시

## ⚠️ 주의사항 및 문제 해결

### 1. 종목코드 형식
- **한국 주식**: 6자리 숫자 (예: 005930)
  - 앞자리 0이 사라지면 '005930 또는 셀 서식을 텍스트로 변경
- **나스닥**: 대문자 티커 (예: AAPL, GOOGL, TSLA)

### 2. 등락률이 소수로 표시될 때
- **원인**: D열 서식이 백분율로 설정 안 됨
- **해결**: D열 선택 → 서식 → 숫자 → 백분율 → 소수점 2자리

### 3. #NAME? 오류
- **원인**: 자동 새로고침 스크립트가 수식 끝에 &t= 추가
- **해결**: 메뉴 → "🔧 오류 수정" 클릭

### 4. "로딩 실패" 표시
- **원인**: IMPORTXML 호출 제한 (50개) 초과
- **해결**: 종목 수를 50개 이하로 줄이기

### 5. E열 참조 오류
- **확인**: 수식에서 E2를 참조하는지 확인 (G2가 아님)
- **시장구분은 E열**에 입력해야 함

## 📚 추가 자료

- [GOOGLEFINANCE 함수 문서](https://support.google.com/docs/answer/3093281)
- [IMPORTXML 함수 문서](https://support.google.com/docs/answer/3093342)

## 🤝 기여

문제점 발견시 이슈를 등록해주세요.

## 📄 라이선스

자유롭게 사용 가능합니다. 단, 실시간 데이터 제공처의 이용약관을 준수해주세요.